


For the citations to be useful in the modelling, we need to put them into groups of topics. This is challenging because the citations are so fragmented - we don't have the complete text of the titles in the citations so we can't use typical text analysis methods like clustering by words or topic modelling. 

How many unique citations do we have?

```{r}
length(unique(xx$.out))
```

How can we put them into groups?

One approach we can try is to identify clusters of similar citations according to their co-occurances in citation lists of articles. The idea is that similar articles will cite similar items. So if we can identify similar citations by looking at their co-occurances, then we can group them into clusters to use at taxa for the extinction-innovation modelling. 

Here's a table of pairwise counts for all citations in our sample:


```{r}
library(tidyverse)
library(tidytext)
# count how many times each pair of citations occurs together in a journal article.
# this is very slow, and produces a data frame with 27 million rows...
library(widyr)
title_word_pairs <-
  xx %>%
  pairwise_count(.out,
                 title,
                 sort = TRUE,
                 upper = FALSE)

title_word_pairs
```

With these pairwise counts we can draw a network plot to get a sense of how meaningful the co-occurances are: 

```{r}

# network plot of citations: co-citations
library(ggplot2)
library(igraph)
library(ggraph)
library(tidygraph)

set.seed(1234)
title_word_pairs %>%
  filter(n >= 25) %>%
  graph_from_data_frame() %>%
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = n, edge_width = n), edge_colour = "cyan4") +
  geom_node_point(size = 5) +
  geom_node_text(aes(label = name), repel = TRUE,
                point.padding = unit(0.2, "lines")) +
  theme_void()
```

We can do community detection on this network to identify clusters of similar citations, according to the frequency of their co-occurance:

```{r}

title_word_pairs %>%
  filter(n >= 25) %>%
  graph_from_data_frame() %>%
  as_tbl_graph() %>%
  mutate(community = as.factor(group_edge_betweenness())) %>%
  ggraph(layout = 'kk') +
  geom_edge_link(aes(alpha = ..index..), show.legend = FALSE) +
  geom_node_point(aes(colour = community), size = 7) +
    geom_node_text(aes(label = name), repel = TRUE,
                point.padding = unit(0.2, "lines")) +
  theme_graph()

```

And here we can get the community membership in a data frame with the citations:

```{r}
citations_community <- 
  title_word_pairs %>% 
 filter(n >= 10) %>%
  graph_from_data_frame() %>%
  as_tbl_graph() %>%
  mutate(community = as.factor(group_edge_betweenness()))  %>% 
  as_tibble
```




# citations for post-processual archaeology?


# get titles with 'theory

theory_articles <-
  xx %>%
  filter(str_detect(title, "theory"))

# how can we network or cluster these?

theory_articles_count <-
theory_articles %>%
  count(.out, sort = TRUE)
